flowchart LR

%% =========================================
%% DAK LOUK - SCREEN FLOW DIAGRAM (UI NAV)
%% (Readability > perfect Mermaid rendering)
%% =========================================

%% ---------- AUTH / ENTRY ----------
Auth[AuthScreen]
UserShell[UserScaffold]
MerchantShell[MerchantScaffold]

Auth -->|Sign Up| UserShell
Auth -->|Log In (Role.user)| UserShell
Auth -->|Log In (Role.merchant)| MerchantShell

UserShell -->|Logout| Auth
MerchantShell -->|Logout| Auth

%% ---------- USER SIDE (tabs -> screens) ----------
UHome[HomeScreen]
ULive[LiveStreamScreen]
UOrders[OrdersScreen]
UChatRooms[ChatRoomScreen]
UProfile[ProfileScreen]

UserShell --> UHome
UserShell --> ULive
UserShell --> UOrders
UserShell --> UChatRooms
UserShell --> UProfile

%% Cart flow (AppBar cart icon)
UCart[CartScreen]
UCheckout[CheckoutScreen]
UserShell -->|AppBar cart icon| UCart
UCart -->|Place All Order| UCheckout
UCheckout -->|Back| UCart

%% Chat flow
UChat[ChatScreen]
UChatRooms -->|Tap chat room| UChat
UChat -->|Back| UChatRooms

%% Post detail / merchant profile flow (user side)
UPostDetail[PostDetailScreen]
UMerchantProfile[MerchantProfileScreen]

UHome -->|Tap Similar Post card| UPostDetail
UHome -->|Tap merchant header| UMerchantProfile
UPostDetail -->|Tap merchant header| UMerchantProfile
UPostDetail -->|Back| UHome
UMerchantProfile -->|Back| UHome

%% Merchant profile tabs (internal)
MPPosts[MerchantPosts (tab)]
MPLive[MerchantLiveStreams (tab)]
MPProducts[MerchantProducts (tab)]
UMerchantProfile --> MPPosts
UMerchantProfile --> MPLive
UMerchantProfile --> MPProducts
MPPosts -->|Tap post| UPostDetail

%% Fullscreen video (shared screen)
FullVideo[FullScreenVideoScreen]
MPLive -->|Tap livestream thumbnail| FullVideo
FullVideo -->|Back| UMerchantProfile

%% ---------- MERCHANT SIDE (tabs -> screens) ----------
MOrders[MerchantOrdersScreen]
MProducts[MerchantProductsScreen]
MPosts[MerchantPostsScreen]
MLive[MerchantLiveScreen]
MChatRooms[MerchantChatRoomScreen]

MerchantShell --> MOrders
MerchantShell --> MProducts
MerchantShell --> MPosts
MerchantShell --> MLive
MerchantShell --> MChatRooms

%% Merchant chat flow
MChat[MerchantChatScreen]
MChatRooms -->|Tap chat room| MChat
MChat -->|Back| MChatRooms

%% Merchant orders: status picker & delete (bottom sheet / dialog)
MOrderStatusSheet[BottomSheet: Change Order Status]
MOrders -->|Tap status pill| MOrderStatusSheet
MOrderStatusSheet -->|Confirm| MOrders

%% Merchant products: create/edit (bottom sheets)
MProdCreate[BottomSheet: ProductsCreateForm]
MProdEdit[BottomSheet: ProductsUpdateForm]
MProducts -->|FAB Add| MProdCreate
MProdCreate -->|Save/Close| MProducts
MProducts -->|Pencil Edit| MProdEdit
MProdEdit -->|Save/Close| MProducts

%% Merchant posts: create/edit (bottom sheets)
MPostCreate[BottomSheet: PostForm (create)]
MPostEdit[BottomSheet: PostEditForm]
MPosts -->|FAB Add| MPostCreate
MPostCreate -->|Save/Close| MPosts
MPosts -->|Edit| MPostEdit
MPostEdit -->|Save/Close| MPosts

%% Merchant live: create/edit (full screens pushed)
MLiveCreate[LiveStreamCreateForm]
MLiveEdit[LiveStreamEditForm]
MLive -->|FAB Add| MLiveCreate
MLiveCreate -->|Navigator.pop(dto)| MLive
MLive -->|Pencil Edit| MLiveEdit
MLiveEdit -->|Navigator.pop(dto)| MLive

%% Merchant live: open fullscreen video
MLive -->|Tap item| FullVideo
FullVideo -->|Back| MLive

%% ---------- SHARED INNER SHEETS (used inside forms / live player) ----------
ProductSelector[BottomSheet: ProductSelectorSheet]
MediaPicker[Sheet: MediaPickerSheet]
FeaturedProductsSheet[BottomSheet: LiveStream Featured Products]

%% product selector used by live create/edit + post create/edit
MLiveCreate -->|Add Product| ProductSelector
MLiveEdit -->|Add Product| ProductSelector
MPostCreate -->|Add Product| ProductSelector
MPostEdit -->|Add Product| ProductSelector
ProductSelector -->|Done| MLiveCreate
ProductSelector -->|Done| MLiveEdit
ProductSelector -->|Done| MPostCreate
ProductSelector -->|Done| MPostEdit

%% media picker used by live create/edit + post create/edit + product create/edit
MLiveCreate -->|Pick Video/Thumbnail| MediaPicker
MLiveEdit -->|Pick Video/Thumbnail| MediaPicker
MPostCreate -->|Add Media| MediaPicker
MPostEdit -->|Add Media| MediaPicker
MProdCreate -->|Pick Image| MediaPicker
MProdEdit -->|Pick Image| MediaPicker
MediaPicker -->|Selected| MLiveCreate
MediaPicker -->|Selected| MLiveEdit
MediaPicker -->|Selected| MPostCreate
MediaPicker -->|Selected| MPostEdit
MediaPicker -->|Selected| MProdCreate
MediaPicker -->|Selected| MProdEdit

%% featured products sheet inside live player widget
FullVideo -->|Tap "Featured Products"| FeaturedProductsSheet
FeaturedProductsSheet -->|Close| FullVideo
